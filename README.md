# Simple-MCP

ä¸€ä¸ªåŸºäº MCP (Model Context Protocol) å’Œæœ¬åœ° Ollama å¤§æ¨¡å‹çš„ç®€å•ç”¨æˆ·æ•°æ®åº“æŸ¥è¯¢ç¨‹åºã€‚æ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡ LLM ç†è§£ç”¨æˆ·æ„å›¾å¹¶è°ƒç”¨ç›¸åº”å·¥å…·è·å–æ•°æ®ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™ä¸ªé¡¹ç›®æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ MCP åè®®è¿æ¥æœ¬åœ°å¤§æ¨¡å‹ï¼ˆOllama qwen3:14bï¼‰ä¸è‡ªå®šä¹‰æ•°æ®åº“å·¥å…·ï¼Œå®ç°æ™ºèƒ½çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥ç”¨ä¸­æ–‡é—®é¢˜æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„æ•°æ®åº“å·¥å…·å¹¶è¿”å›ç»“æœã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… åŸºäº MCP åè®®çš„å·¥å…·è°ƒç”¨æ¡†æ¶
- âœ… **å¤šè½®å·¥å…·è°ƒç”¨**ï¼šLLM å¯æ ¹æ®éœ€è¦è¿›è¡Œå¤šæ¬¡å·¥å…·è°ƒç”¨æ¥æ”¶é›†ä¿¡æ¯ï¼ˆæ–°å¢ï¼ï¼‰
- âœ… æœ¬åœ° Ollama å¤§æ¨¡å‹æ”¯æŒï¼ˆå®Œå…¨ç¦»çº¿ï¼‰
- âœ… è‡ªç„¶è¯­è¨€ç†è§£å’Œæ„å›¾è¯†åˆ«
- âœ… å¤šæ¡ä»¶çµæ´»æŸ¥è¯¢ï¼ˆæ”¯æŒ 6 ç§æŸ¥è¯¢å‚æ•°ï¼‰
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œå¯è§†åŒ–
- âœ… æ™ºèƒ½çš„å¤šæ­¥å·¥å…·è°ƒç”¨æµç¨‹

---

## ğŸ” MCP æŠ€æœ¯ä»‹ç»

### ä»€ä¹ˆæ˜¯ MCPï¼Ÿ

**Model Context Protocol (MCP)** æ˜¯ç”± Anthropic å¼€å‘çš„å¼€æ”¾æ ‡å‡†åè®®ï¼Œç”¨äºåœ¨ AI åº”ç”¨å’Œå¤–éƒ¨å·¥å…·ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚å®ƒå®šä¹‰äº†ä¸€å¥—æ ‡å‡†çš„è¯·æ±‚-å“åº”æ ¼å¼ï¼Œå…è®¸ LLM æ— ç¼è°ƒç”¨å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºã€‚

### MCP çš„æ ¸å¿ƒæ¦‚å¿µ

1. **å·¥å…·å®šä¹‰ (Tools)**: æœåŠ¡å™¨é€šè¿‡ MCP å‘å®¢æˆ·ç«¯å¹¿æ’­å¯ç”¨çš„å·¥å…·åˆ—è¡¨åŠå…¶å‚æ•°å®šä¹‰
2. **å·¥å…·è°ƒç”¨ (Tool Calls)**: å®¢æˆ·ç«¯é€šè¿‡ LLM å†³ç­–åè°ƒç”¨å·¥å…·ï¼Œä¼ é€’ç›¸åº”å‚æ•°
3. **JSON-RPC é€šä¿¡**: ä½¿ç”¨ JSON-RPC 2.0 æ ¼å¼é€šè¿‡ stdio è¿›è¡Œæ¶ˆæ¯äº¤æ¢
4. **ä¼šè¯ç®¡ç†**: å»ºç«‹é•¿è¿æ¥ä¼šè¯ï¼Œæ”¯æŒå¤šæ¬¡å·¥å…·è°ƒç”¨

### MCP åœ¨æœ¬é¡¹ç›®ä¸­çš„ä½œç”¨

**å¤šè½®å·¥å…·è°ƒç”¨æµç¨‹**ï¼š
```
ç”¨æˆ·è¾“å…¥ (è‡ªç„¶è¯­è¨€)
    â†“
LLM ç¬¬1è½®ï¼šç†è§£é—®é¢˜å¹¶å†³ç­–
    â†“ (å¦‚æœéœ€è¦è°ƒç”¨å·¥å…·)
MCP å·¥å…·è°ƒç”¨ (query_users / get_user_relationships / get_spouse ç­‰)
    â†“
æ•°æ®åº“æŸ¥è¯¢æ‰§è¡Œï¼Œè·å¾—ç»“æœ
    â†“ (å°†ç»“æœåŠ å…¥ä¸Šä¸‹æ–‡)
LLM ç¬¬2è½®ï¼šåŸºäºç»“æœå†³ç­–
    â†“ (å¦‚æœè¿˜éœ€è¦ä¿¡æ¯)
MCP å·¥å…·è°ƒç”¨ (å¯ä»¥è°ƒç”¨ä¸åŒçš„å·¥å…·)
    â†“
... (é‡å¤ï¼Œæœ€å¤š10è½®)
    â†“ (å½“æ”¶é›†è¶³å¤Ÿä¿¡æ¯)
LLM ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ
    â†“
ç”¨æˆ·è·å¾—ç»“æœ
```

**å¤šè½®è°ƒç”¨ç¤ºä¾‹ï¼š**
- é—®é¢˜ï¼šã€ŒCharlie çš„çˆ¶æ¯éƒ½æœ‰å“ªäº›å­å¥³ï¼Ÿã€
  1. ç¬¬1è½®ï¼šè°ƒç”¨ `get_parents(3)` è·å– Charlie çš„çˆ¶æ¯ï¼ˆAlice å’Œ Bobï¼‰
  2. ç¬¬2è½®ï¼šè°ƒç”¨ `get_children(1)` è·å– Alice çš„å­å¥³
  3. ç¬¬3è½®ï¼šè°ƒç”¨ `get_children(2)` è·å– Bob çš„å­å¥³ï¼ˆæˆ–åˆå¹¶ç»“æœï¼‰
  4. æœ€åï¼šLLM ç»¼åˆæ‰€æœ‰ä¿¡æ¯ç”Ÿæˆç­”æ¡ˆ

---

## ğŸ“ é¡¹ç›®ç»“æ„

```åŠå…¶äº’ç›¸ä¹‹é—´çš„å…³ç³»ç½‘ç»œçš„æ•°æ®åº“
- å®ç° 8 ä¸ª MCP å·¥å…·ï¼š
  - **æŸ¥è¯¢å·¥å…·**ï¼š`query_users`ï¼ˆå¤šæ¡ä»¶æŸ¥è¯¢ï¼‰ã€`get_user_by_id`ï¼ˆæŒ‰ ID è·å–ï¼‰
  - **å…³ç³»æŸ¥è¯¢å·¥å…·**ï¼š`get_user_relationships`ï¼ˆæ‰€æœ‰å…³ç³»ï¼‰ã€`get_relationship_between_users`ï¼ˆä¸¤äººå…³ç³»ï¼‰
  - **äº²å±æŸ¥è¯¢å·¥å…·**ï¼š`get_spouse`ï¼ˆé…å¶ï¼‰ã€`get_children`ï¼ˆå­å¥³ï¼‰ã€`get_parents`ï¼ˆçˆ¶æ¯ï¼‰ã€`get_relatives_by_relation`ï¼ˆæŒ‰å…³ç³»ç±»å‹æŸ¥è¯¢ï¼‰
- ä½¿ç”¨ FastMCP æ¡†æ¶å¯åŠ¨ MCP æœåŠ¡å™¨
- æ”¯æŒå›¾ç»“æ„å­˜å‚¨å’ŒæŸ¥è¯¢ç”¨æˆ·å…³ç³»ç½‘ç»œ  # å•å…ƒæµ‹è¯•è„šæœ¬ï¼Œæµ‹è¯•æŸ¥è¯¢åŠŸèƒ½
â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â””â”€â”€ å¤šè½®å·¥å…·è°ƒç”¨æµç¨‹ï¼ˆæ”¯æŒæœ€å¤š 10 è½®ï¼‰ï¼š
  1. **å·¥å…·å†³ç­–**ï¼šLLM æ ¹æ®ç”¨æˆ·é—®é¢˜æˆ–å·²æ”¶é›†çš„ä¿¡æ¯å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·
  2. **å·¥å…·è°ƒç”¨**ï¼šè°ƒç”¨ MCP å·¥å…·è·å–æ•°æ®
  3. **è¿­ä»£**ï¼šå°†ç»“æœæ·»åŠ åˆ°ä¸Šä¸‹æ–‡ï¼Œç»§ç»­ä¸‹ä¸€è½®å†³ç­–
  4. **ç­”æ¡ˆç”Ÿæˆ**ï¼šå½“ LLM è®¤ä¸ºä¿¡æ¯è¶³å¤Ÿæ—¶ï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
- å®Œæ•´çš„å·¥å…·è°ƒç”¨å†å²ç®¡ç†
### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

**mcp_server.py**
- å®šä¹‰ 13 ä¸ªç”¨æˆ·çš„æ•°æ®åº“
- å®ç°ä¸¤ä¸ª MCP å·¥å…·ï¼š
  - `query_users`: å¤šæ¡ä»¶ç”¨æˆ·æŸ¥è¯¢ï¼ˆæ”¯æŒ 6 ç§å‚æ•°ï¼‰
  - `get_user_by_id`: æ ¹æ® ID è·å–å•ä¸ªç”¨æˆ·
- ä½¿ç”¨ FastMCP æ¡†æ¶å¯åŠ¨ MCP æœåŠ¡å™¨

**client.py**
- è¿æ¥æœ¬åœ° Ollama æ¨¡å‹ (qwen3:14b)
- å®ç°ä¸¤é˜¶æ®µ LLM å¤„ç†ï¼š
  1. å·¥å…·å†³ç­–ï¼šLLM æ ¹æ®ç”¨æˆ·é—®é¢˜å†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·
  2. ç­”æ¡ˆç”Ÿæˆï¼šLLM æ ¹æ®å·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
- å®æ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯

**test_query_users.py**
- 8 ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰æŸ¥è¯¢åœºæ™¯
- ç›´æ¥æµ‹è¯• query_users å‡½æ•°
- éªŒè¯å„ç§æŸ¥è¯¢å‚æ•°çš„æ­£ç¡®æ€§

---

## ğŸ›  æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Python 3.x**: ä¸»ç¼–ç¨‹è¯­è¨€
- **MCP (Model Context Protocol)**: å·¥å…·è°ƒç”¨åè®®
- **FastMCP**: MCP æœåŠ¡å™¨æ¡†æ¶
- **Pydantic**: æ•°æ®éªŒè¯å’Œç±»å‹æ£€æŸ¥

### LLM æŠ€æœ¯
- **Ollama**: æœ¬åœ° LLM è¿è¡Œæ—¶
- **qwen3:14b**: é€šä¹‰åƒé—® 3 å¤§æ¨¡å‹ï¼ˆ14B å‚æ•°ï¼‰
- **OpenAI API**: Ollama å…¼å®¹çš„ API æ¥å£

### é€šä¿¡åè®®
- **JSON-RPC 2.0**: æ¶ˆæ¯æ ¼å¼
- **stdio**: ä¼ è¾“æ–¹å¼ï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰

---

## ğŸ Python åº“è¯¦è§£

### æ ¸å¿ƒä¾èµ–

**1. mcp (>=1.0.0)**
- **ä½œç”¨**: Model Context Protocol çš„ Python SDK
- **åŠŸèƒ½**: 
  - å®šä¹‰å’Œç®¡ç† MCP åè®®çš„é€šä¿¡
  - æœåŠ¡å™¨ç«¯å·¥å…·æ³¨å†Œå’Œè¯·æ±‚å¤„ç†
  - å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„äº¤äº’
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: 
  - `mcp_server.py` ä¸­ç”¨ FastMCP å¯åŠ¨æœåŠ¡å™¨
  - `client.py` ä¸­ç”¨ StdioClient è¿æ¥æœåŠ¡å™¨

**2. openai (>=1.0.0)**
- **ä½œç”¨**: OpenAI API å…¼å®¹çš„å®¢æˆ·ç«¯åº“
- **åŠŸèƒ½**:
  - ä¸ Ollama æœ¬åœ°æ¨¡å‹é€šä¿¡ï¼ˆOllama æä¾› OpenAI å…¼å®¹ APIï¼‰
  - å‘é€èŠå¤©è¯·æ±‚åˆ°å¤§æ¨¡å‹
  - å¤„ç†æµå¼å’Œéæµå¼å“åº”
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: `client.py` ä¸­ä¸ qwen3:14b æ¨¡å‹é€šä¿¡
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from openai import OpenAI
  client = OpenAI(
      api_key="sk-xxx",
      base_url="http://localhost:11434/v1"
  )
  response = client.chat.completions.create(
      model="qwen3:14b",
      messages=[...],
      temperature=0
  )
  ```

**3. pydantic (>=2.0.0)**
- **ä½œç”¨**: Python æ•°æ®éªŒè¯å’Œç±»å‹æ£€æŸ¥åº“
- **åŠŸèƒ½**:
  - æ•°æ®æ¨¡å‹å®šä¹‰å’ŒéªŒè¯
  - è‡ªåŠ¨ç±»å‹è½¬æ¢å’Œå¼ºåˆ¶æ£€æŸ¥
  - ç”Ÿæˆ JSON Schemaï¼ˆç”¨äº MCP å·¥å…·å®šä¹‰ï¼‰
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**:
  - `mcp_server.py` ä¸­å®šä¹‰ `QueryUsersParams` å’Œ `QueryUsersResult`
  - è‡ªåŠ¨éªŒè¯ MCP å·¥å…·å‚æ•°ç±»å‹
  - `client.py` ä¸­çš„ç±»å‹æç¤º
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from pydantic import BaseModel, Field
  class QueryUsersParams(BaseModel):
      name: Optional[str] = None
      min_age: Optional[int] = None
      max_age: Optional[int] = None
  ```

### æ ‡å‡†åº“ä½¿ç”¨

**asyncio**
- **ç”¨é€”**: å¼‚æ­¥ç¼–ç¨‹æ”¯æŒ
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: MCP å·¥å…·å‡½æ•°éƒ½æ˜¯ async å‡½æ•°ï¼Œæ”¯æŒå¹¶å‘å¤„ç†

**typing**
- **ç”¨é€”**: ç±»å‹æç¤ºå’Œç±»å‹æ£€æŸ¥
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: æ‰€æœ‰å‡½æ•°å’Œå˜é‡éƒ½æœ‰ç±»å‹æ³¨è§£

**json**
- **ç”¨é€”**: JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: å¤„ç† MCP æ¶ˆæ¯æ ¼å¼å’Œ LLM å“åº”

**pathlib**
- **ç”¨é€”**: è·¨å¹³å°è·¯å¾„å¤„ç†
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: æ“ä½œæ—¥å¿—æ–‡ä»¶è·¯å¾„

**sys**
- **ç”¨é€”**: ç³»ç»Ÿç›¸å…³åŠŸèƒ½
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: 
  - å°†æ—¥å¿—è¾“å‡ºåˆ° stderrï¼ˆé¿å…å¹²æ‰° stdio åè®®ï¼‰
  - æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯æµç®¡ç†

**shutil**
- **ç”¨é€”**: é«˜çº§æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ“ä½œ
- **åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨**: è·å–ç»ˆç«¯çª—å£å°ºå¯¸ç”¨äºç¾åŒ–è¾“å‡º

---

## ğŸ“¦ å®‰è£…å’Œè¿è¡Œ

### å‰ç½®æ¡ä»¶

1. **Python 3.8+ï¼ˆæ¨è 3.10+ï¼‰**
   ```bash
   python --version
   ```
   - æ”¯æŒ Python 3.8ã€3.9ã€3.10ã€3.11ã€3.12
   - æ¨èä½¿ç”¨ Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½
   - éœ€è¦ pip åŒ…ç®¡ç†å·¥å…·ï¼ˆé€šå¸¸ä¸ Python ä¸€èµ·å®‰è£…ï¼‰

2. **å®‰è£… Ollama**
   - è®¿é—® https://ollama.ai ä¸‹è½½å®‰è£…
   - ä¸‹è½½ qwen3:14b æ¨¡å‹ï¼š
     ```bash
     ollama pull qwen3:14b
     ```
   - å¯åŠ¨ Ollama æœåŠ¡ï¼š
     ```bash
     ollama serve
     ```
     Ollama ä¼šåœ¨ `http://localhost:11434` å¯åŠ¨æœåŠ¡

### å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### è¿è¡Œåº”ç”¨

**ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ MCP æœåŠ¡å™¨**

æ‰“å¼€ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œï¼š
```bash
python mcp_server.py
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š
```
=========================================================================================
                                    MCP æœåŠ¡å™¨å¯åŠ¨
=========================================================================================

å·²åŠ è½½ 13 ä¸ªç”¨æˆ·æ•°æ®

å·¥ä½œåŸç†:
  1. æœåŠ¡å™¨ä½¿ç”¨ stdio (æ ‡å‡†è¾“å…¥è¾“å‡º) åè®®é€šä¿¡
  2. ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯é€šè¿‡ stdin å‘é€è¯·æ±‚
  3. æ¯æ¬¡å®¢æˆ·ç«¯è°ƒç”¨å·¥å…·æ—¶ï¼Œè§£æè¯·æ±‚å‚æ•°å¹¶æ‰§è¡ŒæŸ¥è¯¢
  4. æ‰§è¡Œå®Œæ¯•åè¿”å› JSON æ ¼å¼ç»“æœ

å¯ç”¨å·¥å…·:
  â€¢ query_users - æ ¹æ®å¤šæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·
  â€¢ get_user_by_id - æ ¹æ®IDè·å–å•ä¸ªç”¨æˆ·

                             MCP æœåŠ¡å™¨å°±ç»ªï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...
=========================================================================================
```

**ç¬¬äºŒæ­¥ï¼šå¯åŠ¨å®¢æˆ·ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰**

æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œè¿è¡Œï¼š
```bash
python client.py
```

ç„¶åå¼€å§‹è¾“å…¥é—®é¢˜è¿›è¡ŒæŸ¥è¯¢ã€‚

---

## ğŸ¯ åŠŸèƒ½ä»‹ç»

### å…³ç³»æŸ¥è¯¢å·¥å…·é›†ï¼ˆ8 ä¸ªå·¥å…·ç”¨äºæŸ¥è¯¢ç”¨æˆ·å…³ç³»ï¼‰

| å·¥å…·å | åŠŸèƒ½ | è¿”å›å†…å®¹ |
|------|------|--------|
| `get_user_relationships` | æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰å…³ç³» | ç”¨æˆ·åŠå…¶æ‰€æœ‰å…³ç³»åˆ—è¡¨ |
| `get_relationship_between_users` | æŸ¥è¯¢ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„å…³ç³» | ä¸¤äººä¹‹é—´çš„å…·ä½“å…³ç³» |
| `get_spouse` | æŸ¥è¯¢é…å¶ | ç”¨æˆ·çš„é…å¶ä¿¡æ¯ |
| `get_children` | æŸ¥è¯¢æ‰€æœ‰å­å¥³ | å­å¥³åˆ—è¡¨åŠä¿¡æ¯ |
| `get_parents` | æŸ¥è¯¢çˆ¶æ¯ | çˆ¶æ¯åˆ—è¡¨åŠä¿¡æ¯ |
| `get_relatives_by_relation` | æŒ‰å…³ç³»ç±»å‹æŸ¥è¯¢äº²æˆš | ç‰¹å®šç±»å‹äº²æˆšåˆ—è¡¨ |

**å¤šè½®æŸ¥è¯¢ä¾‹å­ï¼š**
- ã€ŒAlice çš„é…å¶çš„ email æ˜¯ä»€ä¹ˆï¼Ÿã€
  - ç¬¬ 1 è½®ï¼šè°ƒç”¨ `get_spouse(1)` â†’ è·å¾— Bob çš„å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…æ‹¬ emailï¼‰
  - ç­”æ¡ˆï¼šbob@example.com

- ã€ŒCharlie çš„çˆ¶æ¯åˆ†åˆ«æœ‰å“ªäº›å­å¥³ï¼Ÿã€
  - ç¬¬ 1 è½®ï¼šè°ƒç”¨ `get_parents(3)` â†’ è·å¾—çˆ¶æ¯ Alice(ID=1) å’Œ Bob(ID=2)
  - ç¬¬ 2 è½®ï¼šè°ƒç”¨ `get_children(1)` â†’ è·å¾— Alice çš„å­å¥³
  - ç¬¬ 3 è½®ï¼šè°ƒç”¨ `get_children(2)` â†’ è·å¾— Bob çš„å­å¥³
  - ç­”æ¡ˆï¼šç»¼åˆç»“æœå›ç­”

### query_users å·¥å…· - å¤šæ¡ä»¶ç”¨æˆ·æŸ¥è¯¢

æ”¯æŒä»¥ä¸‹ 6 ç§æŸ¥è¯¢å‚æ•°ï¼Œå¯è‡ªç”±ç»„åˆï¼š

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `name` | å­—ç¬¦ä¸² | æŒ‰å§“åæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ |
| `min_age` | æ•´æ•° | æœ€å°å¹´é¾„ï¼ˆåŒ…å«è¾¹ç•Œï¼Œå³ >= min_ageï¼‰ |
| `max_age` | æ•´æ•° | æœ€å¤§å¹´é¾„ï¼ˆåŒ…å«è¾¹ç•Œï¼Œå³ <= max_ageï¼‰ |
| `age_greater_than` | æ•´æ•° | å¹´é¾„å¤§äºï¼ˆä¸åŒ…å«è¾¹ç•Œï¼Œå³ > age_greater_thanï¼‰ |
| `age_less_than` | æ•´æ•° | å¹´é¾„å°äºï¼ˆä¸åŒ…å«è¾¹ç•Œï¼Œå³ < age_less_thanï¼‰ |
| `email_contains` | å­—ç¬¦ä¸² | é‚®ç®±åŒ…å«çš„å­—ç¬¦ä¸²ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰ |

### get_user_by_id å·¥å…· - æŒ‰ ID è·å–ç”¨æˆ·

é€šè¿‡ç”¨æˆ· ID å¿«é€Ÿè·å–å•ä¸ªç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯ã€‚

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æŸ¥è¯¢å¹´é¾„å¤§äº 30 çš„ç”¨æˆ·

**è¾“å…¥ï¼š**
```
ä½ : æœ‰å“ªäº›ageå¤§äº30çš„ç”¨æˆ·
```

**å®Œæ•´äº¤äº’æµç¨‹æ—¥å¿—ï¼š**

```
======================================================================
[å‘ç»™ LLM çš„åŸå§‹è¯·æ±‚æ–‡æœ¬ #1 - å·¥å…·å†³ç­–]
======================================================================
System: ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æŸ¥è¯¢ç”¨æˆ·æ•°æ®åº“ã€‚
        
å¯ç”¨çš„å·¥å…·ï¼š
1. query_users - æ ¹æ®æ¡ä»¶æŸ¥è¯¢å¤šä¸ªç”¨æˆ·
   å‚æ•°ï¼š
   - name: æŒ‰å§“åæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼‰
   - min_age: æœ€å°å¹´é¾„ï¼ŒåŒ…å«è¾¹ç•Œï¼Œå³ >= min_ageï¼ˆå¯é€‰ï¼Œæ•´æ•°ç±»å‹ï¼Œå¦‚30ï¼‰
   - max_age: æœ€å¤§å¹´é¾„ï¼ŒåŒ…å«è¾¹ç•Œï¼Œå³ <= max_ageï¼ˆå¯é€‰ï¼Œæ•´æ•°ç±»å‹ï¼Œå¦‚35ï¼‰
   - age_greater_than: å¹´é¾„å¤§äºï¼Œä¸åŒ…å«è¾¹ç•Œï¼Œå³ > age_greater_thanï¼ˆå¯é€‰ï¼Œæ•´æ•°ç±»å‹ï¼Œå¦‚30ï¼‰
   - age_less_than: å¹´é¾„å°äºï¼Œä¸åŒ…å«è¾¹ç•Œï¼Œå³ < age_less_thanï¼ˆå¯é€‰ï¼Œæ•´æ•°ç±»å‹ï¼Œå¦‚25ï¼‰
   - email_contains: é‚®ç®±åŒ…å«çš„å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼‰

2. get_user_by_id - æ ¹æ®IDè·å–å•ä¸ªç”¨æˆ·
   å‚æ•°ï¼š
   - user_id: ç”¨æˆ·IDï¼ˆå¿…éœ€ï¼Œæ•´æ•°ç±»å‹ï¼‰

å½“ç”¨æˆ·è¯¢é—®ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä½ åº”è¯¥ï¼š
1. åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼Œåˆ¤æ–­éœ€è¦å“ªä¸ªå·¥å…·
2. æå–ç›¸å…³å‚æ•°ï¼Œæ³¨æ„å‚æ•°ç±»å‹å¿…é¡»æ­£ç¡®ï¼ˆæ•´æ•°ç±»å‹çš„å­—æ®µä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²ï¼‰
3. ä»¥ä¸¥æ ¼çš„ JSON æ ¼å¼è¿”å›å·¥å…·è°ƒç”¨ä¿¡æ¯

User: æœ‰å“ªäº›ageå¤§äº30çš„ç”¨æˆ·

======================================================================

ğŸ¤– [æ¥è‡ª LLM çš„åŸå§‹å“åº”æ–‡æœ¬ #1]:
{
  "tool": "query_users",
  "arguments": {
    "age_greater_than": 30
  }
}

======================================================================
[13:44:06] LLM å†³ç­–å®Œæˆ (è€—æ—¶: 24.24ç§’)

[å·¥å…·è°ƒç”¨] query_users
[å·¥å…·å‚æ•°] {'age_greater_than': 30}
[13:44:06] å¼€å§‹è°ƒç”¨ MCP å·¥å…·
[13:44:06] å·¥å…·è°ƒç”¨å®Œæˆ (è€—æ—¶: 0.57ç§’)
[å·¥å…·ç»“æœ] {'status': 'success', 'count': 4, 'users': [
  {'id': 3, 'name': 'Charlie', 'email': 'charlie@example.com', 'age': 35},
  {'id': 5, 'name': 'Emma', 'email': 'emma.johnson@example.com', 'age': 32},
  {'id': 7, 'name': 'Grace', 'email': 'grace.lee@example.com', 'age': 31},
  {'id': 10, 'name': 'Jack', 'email': 'jack.taylor@example.com', 'age': 33}
]}

[13:44:06] å‘ LLM è¯·æ±‚ç”Ÿæˆæœ€ç»ˆå›ç­”

======================================================================
[å‘ç»™ LLM çš„åŸå§‹è¯·æ±‚æ–‡æœ¬ #2 - æœ€ç»ˆå›ç­”ç”Ÿæˆ]
======================================================================
System: ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œæ ¹æ®å·¥å…·è¿”å›çš„æ•°æ®å›ç­”ç”¨æˆ·é—®é¢˜ã€‚

å›ç­”è¦æ±‚ï¼š
- ä½¿ç”¨ç®€æ´æ¸…æ™°çš„ä¸­æ–‡å›ç­”
- ä¸è¦ä½¿ç”¨ä»»ä½• markdown è¯­æ³•ï¼ˆå¦‚ **åŠ ç²—**ã€## æ ‡é¢˜ã€- åˆ—è¡¨ç­‰ï¼‰
- ä¸è¦è¾“å‡ºä»£ç å—æˆ–ä»£ç æ®µ
- ç›´æ¥è¾“å‡ºçº¯æ–‡æœ¬ç­”æ¡ˆï¼Œä¾¿äºç»ˆç«¯æ˜¾ç¤º

User: é—®é¢˜: æœ‰å“ªäº›ageå¤§äº30çš„ç”¨æˆ·
å·¥å…·ç»“æœ: {
  "status": "success",
  "count": 4,
  "users": [
    {"id": 3, "name": "Charlie", "email": "charlie@example.com", "age": 35},
    {"id": 5, "name": "Emma", "email": "emma.johnson@example.com", "age": 32},
    {"id": 7, "name": "Grace", "email": "grace.lee@example.com", "age": 31},
    {"id": 10, "name": "Jack", "email": "jack.taylor@example.com", "age": 33}
  ]
}

======================================================================
[13:44:28] æœ€ç»ˆå›ç­”ç”Ÿæˆå®Œæˆ (è€—æ—¶: 21.87ç§’)
[æ€»è€—æ—¶] 46.69ç§’

ğŸ¤– AI å‘ç»™ç”¨æˆ·çš„å›ç­”: å…±æœ‰4ä½å¹´é¾„å¤§äº30çš„ç”¨æˆ·ï¼š
1ã€Charlieï¼ˆ35å²ï¼Œé‚®ç®±ï¼šcharlie@example.comï¼‰
2ã€Emmaï¼ˆ32å²ï¼Œé‚®ç®±ï¼šemma.johnson@example.comï¼‰
3ã€Graceï¼ˆ31å²ï¼Œé‚®ç®±ï¼šgrace.lee@example.comï¼‰
4ã€Jackï¼ˆ33å²ï¼Œé‚®ç®±ï¼šjack.taylor@example.comï¼‰
```

### ç¤ºä¾‹ 2: å…¶ä»–å¯èƒ½çš„æŸ¥è¯¢

```
ä½ : åå­—ä¸­åŒ…å«"David"ä¸”å¹´é¾„åœ¨25åˆ°30å²ä¹‹é—´çš„ç”¨æˆ·æœ‰è°

ä½ : é‚®ç®±åŒ…å«"smith"çš„ç”¨æˆ·æ˜¯è°

ä½ : æŸ¥è¯¢ç”¨æˆ·IDä¸º5çš„ä¿¡æ¯

ä½ : å¹´é¾„å°äº25å²çš„ç”¨æˆ·æœ‰å¤šå°‘ä¸ª
```

---

## ğŸ“Š æœåŠ¡å™¨æ—¥å¿—ç¤ºä¾‹

æœåŠ¡å™¨å¯åŠ¨æ—¶è¾“å‡ºï¼š

```
=========================================================================================
                                    MCP æœåŠ¡å™¨å¯åŠ¨
=========================================================================================

å·²åŠ è½½ 13 ä¸ªç”¨æˆ·æ•°æ®

å·¥ä½œåŸç†:
  1. æœåŠ¡å™¨ä½¿ç”¨ stdio (æ ‡å‡†è¾“å…¥è¾“å‡º) åè®®é€šä¿¡
  2. ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯é€šè¿‡ stdin å‘é€è¯·æ±‚
  3. æ¯æ¬¡å®¢æˆ·ç«¯è°ƒç”¨å·¥å…·æ—¶ï¼Œè§£æè¯·æ±‚å‚æ•°å¹¶æ‰§è¡ŒæŸ¥è¯¢
  4. æ‰§è¡Œå®Œæ¯•åè¿”å› JSON æ ¼å¼ç»“æœ

å¯ç”¨å·¥å…·:
  â€¢ query_users - æ ¹æ®å¤šæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·
  â€¢ get_user_by_id - æ ¹æ®IDè·å–å•ä¸ªç”¨æˆ·

                             MCP æœåŠ¡å™¨å°±ç»ªï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...
=========================================================================================
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### ä¸¤æ­¥å¼ LLM å¤„ç†æµç¨‹

```
ç”¨æˆ·è¾“å…¥é—®é¢˜
    â†“
[ç¬¬ä¸€æ­¥] å·¥å…·å†³ç­–
    - LLM åˆ†æé—®é¢˜
    - ç¡®å®šè°ƒç”¨å“ªä¸ªå·¥å…·
    - æå–ç›¸å…³å‚æ•°
    - è¿”å› JSON æ ¼å¼çš„å·¥å…·è°ƒç”¨
    â†“
[å·¥å…·æ‰§è¡Œ]
    - MCP å®¢æˆ·ç«¯æ‰§è¡Œå·¥å…·
    - æ•°æ®åº“è¿”å›ç»“æœ
    â†“
[ç¬¬äºŒæ­¥] ç­”æ¡ˆç”Ÿæˆ
    - LLM æ ¹æ®å·¥å…·ç»“æœ
    - ç”Ÿæˆç”¨æˆ·å‹å¥½çš„æœ€ç»ˆç­”æ¡ˆ
    â†“
æœ€ç»ˆç­”æ¡ˆå±•ç¤ºç»™ç”¨æˆ·
```

### æ—¥å¿—è®°å½•

æ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šç”Ÿæˆè¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- âœ… æ¥æ”¶åˆ°çš„ç”¨æˆ·é—®é¢˜
- âœ… LLM çš„å·¥å…·å†³ç­–è¿‡ç¨‹
- âœ… å‘é€ç»™ LLM çš„å®Œæ•´æç¤ºè¯
- âœ… LLM çš„åŸå§‹å“åº”
- âœ… å·¥å…·çš„æ‰§è¡Œå‚æ•°å’Œç»“æœ
- âœ… æœ€ç»ˆç”Ÿæˆçš„ç­”æ¡ˆ
- âœ… æ•´ä¸ªæµç¨‹çš„è€—æ—¶ç»Ÿè®¡

---

## ğŸ§ª æµ‹è¯•

è¿è¡Œå•å…ƒæµ‹è¯•éªŒè¯æ‰€æœ‰æŸ¥è¯¢åŠŸèƒ½ï¼š

```bash
python test_query_users.py
```

æµ‹è¯•è¦†ç›–å†…å®¹ï¼š
- æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
- æŒ‰å§“åæŸ¥è¯¢
- æŒ‰å¹´é¾„èŒƒå›´æŸ¥è¯¢ï¼ˆåŒ…å«è¾¹ç•Œï¼‰
- æŒ‰é‚®ç®±æŸ¥è¯¢
- ç»„åˆæ¡ä»¶æŸ¥è¯¢
- å¹´é¾„å¤§äºæŸ¥è¯¢ï¼ˆä¸åŒ…å«è¾¹ç•Œï¼‰
- å¹´é¾„å°äºæŸ¥è¯¢ï¼ˆä¸åŒ…å«è¾¹ç•Œï¼‰
- å¹´é¾„åŒºé—´æŸ¥è¯¢ï¼ˆæ’ä»–æ€§è¾¹ç•Œï¼‰

---

## ğŸ“ å­¦ä¹ é‡ç‚¹

è¿™ä¸ªé¡¹ç›®é€‚åˆå­¦ä¹ ä»¥ä¸‹å†…å®¹ï¼š

1. **MCP åè®®çš„å®ç°**ï¼šäº†è§£å¦‚ä½•å®šä¹‰å’Œè°ƒç”¨å·¥å…·
2. **LLM é›†æˆ**ï¼šå¦‚ä½•å°†æœ¬åœ°å¤§æ¨¡å‹ä¸åº”ç”¨é›†æˆ
3. **ä¸¤é˜¶æ®µ LLM å¤„ç†**ï¼šå·¥å…·å†³ç­–å’Œç»“æœç†è§£
4. **JSON-RPC é€šä¿¡**ï¼šstdio åè®®çš„ä½¿ç”¨
5. **å¼‚æ­¥ç¼–ç¨‹**ï¼šasync/await åœ¨ MCP ä¸­çš„åº”ç”¨
6. **æ—¥å¿—ç³»ç»Ÿ**ï¼šå®Œæ•´çš„è¿è¡Œæ—¥å¿—è®°å½•
7. **æ•°æ®éªŒè¯**ï¼šPydantic æ¨¡å‹çš„ä½¿ç”¨

---

## ğŸ“ Python ç‰ˆæœ¬å’Œä¾èµ–åˆ—è¡¨

### Python ç‰ˆæœ¬è¦æ±‚

| Python ç‰ˆæœ¬ | æ”¯æŒæƒ…å†µ | æ¨èåº¦ |
|-----------|--------|--------|
| 3.8 | âœ… æ”¯æŒ | â­ æœ€ä½ç‰ˆæœ¬ |
| 3.9 | âœ… æ”¯æŒ | â­â­ |
| 3.10 | âœ… æ”¯æŒ | â­â­â­ æ¨è |
| 3.11 | âœ… æ”¯æŒ | â­â­â­ æ¨è |
| 3.12 | âœ… æ”¯æŒ | â­â­â­â­ æœ€æ–°ç¨³å®š |

### é¡¹ç›®ä¾èµ–

```txt
mcp>=1.0.0              # Model Context Protocol SDK - MCP åè®®æ”¯æŒ
openai>=1.0.0           # OpenAI å…¼å®¹ API - ä¸ Ollama é€šä¿¡
pydantic>=2.0.0         # æ•°æ®éªŒè¯å’Œç±»å‹æ£€æŸ¥ - å‚æ•°éªŒè¯å’Œç±»å‹å¼ºåˆ¶
```

### å®‰è£…ä¾èµ–è¯¦è§£

åˆ›å»º `requirements.txt` æ–‡ä»¶å†…å®¹å¦‚ä¸Šï¼Œç„¶åæ‰§è¡Œï¼š

```bash
pip install -r requirements.txt
```

ä¹Ÿå¯ä»¥åˆ†åˆ«å®‰è£…ï¼š

```bash
pip install mcp>=1.0.0
pip install openai>=1.0.0
pip install pydantic>=2.0.0
```

**ç‰ˆæœ¬é€‰æ‹©å»ºè®®ï¼š**
- ä½¿ç”¨ `mcp>=1.0.0` ç¡®ä¿è·å¾—æœ€æ–°çš„ MCP åè®®æ”¯æŒ
- ä½¿ç”¨ `openai>=1.0.0` å…¼å®¹ Ollama çš„ OpenAI API
- ä½¿ç”¨ `pydantic>=2.0.0` è·å¾—æ€§èƒ½æ”¹è¿›å’Œæ–°åŠŸèƒ½

---

## ğŸ“„ è®¸å¯è¯

MIT License
